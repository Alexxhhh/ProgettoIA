
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avventura nel Tempio Labirintico</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #dcdcdc;
            --title-color: #e0b45c;
            --border-color: #444;
            --accent-color: #8c7341;
            --disabled-color: #555;
            --danger-color: #b33a3a;
            --life-color: #ff4d4d;
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #game-container {
            width: 100%;
            max-width: 1200px;
            border: 2px solid var(--border-color);
            background-color: #252525;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        }

        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background-color: #333;
            border-bottom: 2px solid var(--border-color);
        }

        #room-name {
            font-size: 1.8em;
            color: var(--title-color);
            text-shadow: 1px 1px 2px black;
        }

        #lives {
            font-size: 1.8em;
            color: var(--life-color);
            letter-spacing: 3px;
        }

        #main-content {
            display: flex;
            flex-direction: row;
        }

        #inventory-panel {
            width: 25%;
            min-width: 200px;
            padding: 20px;
            border-right: 2px solid var(--border-color);
            background-color: #2a2a2a;
        }

        #inventory-panel h3 {
            margin-top: 0;
            color: var(--title-color);
            border-bottom: 1px solid var(--accent-color);
            padding-bottom: 10px;
        }

        #inventory-panel ul {
            list-style-type: none;
            padding: 0;
        }

        #inventory-panel li {
            padding: 5px 0;
            font-size: 1.1em;
        }
        
        #inventory-keys li {
            color: var(--title-color);
        }

        #center-panel {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #room-image-container {
            width: 100%;
            max-width: 600px;
            height: 400px;
            border: 2px solid var(--border-color);
            background-color: #111;
        }
        
        #room-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #room-description {
            margin-top: 20px;
            font-size: 1.2em;
            line-height: 1.6;
            text-align: center;
            max-width: 600px;
        }
        
        #message-area {
            margin-top: 15px;
            height: 25px;
            font-size: 1.1em;
            font-style: italic;
            color: var(--title-color);
            text-align: center;
        }

        #interaction-area {
            margin-top: 20px;
            width: 100%;
            max-width: 400px;
        }

        .movement-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
        }

        .move-btn {
            padding: 15px;
            font-size: 1.2em;
            font-family: 'Georgia', serif;
            background-color: var(--accent-color);
            color: white;
            border: 1px solid #c8a86c;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .move-btn:hover:not(:disabled) {
            background-color: #a88d55;
        }

        .move-btn:disabled {
            background-color: var(--disabled-color);
            color: #888;
            cursor: not-allowed;
            border-color: #666;
        }
        
        #btn-n { grid-column: 2; grid-row: 1; }
        #btn-w { grid-column: 1; grid-row: 2; }
        #btn-e { grid-column: 3; grid-row: 2; }
        #btn-s { grid-column: 2; grid-row: 3; }

        .puzzle-interface {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .puzzle-interface p {
            margin: 0;
            text-align: center;
            font-style: italic;
        }

        #puzzle-input {
            width: 80%;
            padding: 10px;
            font-size: 1.1em;
            background-color: #333;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            text-align: center;
        }
        
        #puzzle-submit {
            padding: 10px 30px;
            font-size: 1.1em;
            background-color: var(--accent-color);
            color: white;
            border: 1px solid #c8a86c;
            cursor: pointer;
        }
        #puzzle-submit:hover {
            background-color: #a88d55;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            z-index: 1000;
        }

        .overlay h1 {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        #victory-screen h1 { color: var(--title-color); }
        #game-over-screen h1 { color: var(--danger-color); }

        .restart-btn {
            padding: 15px 40px;
            font-size: 1.5em;
            cursor: pointer;
            background-color: var(--text-color);
            color: var(--bg-color);
            border: none;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="header">
            <h1 id="room-name"></h1>
            <div id="lives"></div>
        </div>
        <div id="main-content">
            <div id="inventory-panel">
                <h3>Inventario</h3>
                <ul id="inventory-items"></ul>
                <h3>Chiavi</h3>
                <ul id="inventory-keys"></ul>
            </div>
            <div id="center-panel">
                <div id="room-image-container">
                    <img id="room-image" src="" alt="Immagine della stanza">
                </div>
                <p id="room-description"></p>
                <div id="message-area"></div>
                <div id="interaction-area"></div>
            </div>
        </div>
    </div>
    
    <div id="victory-screen" class="overlay">
        <h1>Congratulazioni! Hai trovato il tesoro!</h1>
        <button class="restart-btn" onclick="location.reload()">Ricomincia</button>
    </div>

    <div id="game-over-screen" class="overlay">
        <h1>Game Over! Sei rimasto senza vite.</h1>
        <button class="restart-btn" onclick="location.reload()">Ricomincia</button>
    </div>

    <script>
        const images_path = 'jpg/';

        const rooms = {
            1: { id: 1, name: "Entrate del tempio", description: "Ti trovi davanti alla massiccia porta di pietra di un antico tempio. L'aria è fredda e umida. L'unica via è proseguire all'interno.", image: "1.jpg", connections: { n: 2, e: 13, s: 12, w: null } },
            2: { id: 2, name: "Stanza buia", description: "Appena entri, un frastuono assordante ti investe. Il tetto è coperto da un'infinità di pipistrelli, disturbati dalla tua presenza. Devi trovare un modo per passare.", image: "2.jpg", connections: { n: null, e: 3, s: 1, w: null }, puzzle: { type: 'item', question: 'La stanza è piena di pipistrelli, che oggetto intendi usare per attraversarla?', answer: 'Torcia' } },
            3: { id: 3, name: "Stanza con chiave", description: "Al centro della stanza, un piedistallo di pietra è illuminato da un fioco raggio di luce. Sopra di esso, brilla una vecchia chiave di bronzo.", image: "3.jpg", key: 'k4', connections: { n: null, e: 4, s: null, w: 2 } },
            4: { id: 4, name: "Stanza della saggezza", description: "Le pareti di questa stanza sono coperte di geroglifici indecifrabili. Al centro, della sabbia dorata forma un cerchio perfetto sul pavimento di pietra.", image: "4.jpg", connections: { n: null, e: 5, s: 14, w: 3 }, keyRequired: { e: 'k1' }, puzzle: { type: 'riddle', question: 'Mi trovi nel presente, ma non posso essere toccato. Passo silenzioso, nessuno mi vede arrivare. Posso guarire o distruggere. Chi sono?', answer: 'Tempo' } },
            5: { id: 5, name: "Stanza del gas", description: "Un sibilo sinistro riempie l'aria mentre un gas violaceo inizia a fuoriuscire dalle fessure nel muro. Devi agire in fretta.", image: "5.jpg", connections: { n: null, e: 6, s: 15, w: 4 }, keyRequired: { s: 'k1', w: 'k1' }, puzzle: { type: 'item', question: 'Hai azionato una trappola e la stanza si sta riempiendo di gas! Che oggetto vuoi usare?', answer: 'Panno_bagnato' } },
            6: { id: 6, name: "Fontana", description: "Una stanza tranquilla e umida. Al centro, una fontana di pietra zampilla acqua fresca e cristallina, un'oasi di pace in questo luogo ostile.", image: "6.jpg", connections: { n: null, e: null, s: 7, w: 5 } },
            7: { id: 7, name: "Stanza dei fratelli", description: "Quattro imponenti statue maschili, dall'aspetto severo, sono disposte ai quattro angoli della stanza. Sembrano giudicare ogni tuo passo.", image: "7.jpg", connections: { n: 6, e: null, s: 8, w: 15 }, keyRequired: { w: 'k3' }, puzzle: { type: 'riddle', question: 'Fratelli corrono insieme, nessuno lascia mai il proprio cammino. A volte sono calmi, a volte in guerra, ma sempre si inseguono all\'infinito.', answer: 'Stagioni' } },
            8: { id: 8, name: "Stanza con chiave", description: "In un angolo buio, noti un bagliore. Una chiave d'argento è appoggiata su una roccia, come se ti stesse aspettando.", image: "8.jpg", key: 'k3', connections: { n: 7, e: null, s: null, w: 9 } },
            9: { id: 9, name: "Sedia", description: "Una stanza spoglia, fatta eccezione per una singola sedia di legno posta al centro. Chi si sarebbe seduto qui, e perché?", image: "9.jpg", connections: { n: 15, e: 8, s: null, w: 10 }, keyRequired: { n: 'k2', w: 'k4' } },
            10: { id: 10, name: "Stanza dei buchi", description: "Le pareti lisce di questo corridoio sono costellate di piccoli fori scuri. Un meccanismo a pressione sul pavimento suggerisce che non è un buon posto dove fermarsi.", image: "10.jpg", connections: { n: 14, e: 9, s: null, w: 11 }, keyRequired: { e: 'k4' }, puzzle: { type: 'item', question: 'La stanza è piena di buchi sulle pareti. Che oggetto vuoi usare per proseguire?', answer: 'Scudo' } },
            11: { id: 11, name: "Stanza con chiave", description: "Una chiave di ferro nero giace su un altare grezzo. Emana un'aura di potere antico.", image: "11.jpg", key: 'k1', connections: { n: null, e: 10, s: null, w: 13 } },
            12: { id: 12, name: "Stanza misteriosa", description: "La polvere ricopre ogni superficie in questa stanza silenziosa. Sembra che nessuno metta piede qui da secoli. Un senso di attesa pervade l'aria.", image: "12.jpg", connections: { n: 1, e: 14, s: null, w: null }, puzzle: { type: 'riddle', question: 'Ho occhi ma non posso vedere, una bocca ma non posso parlare, una forma umana ma non lo sono. Chi sono?', answer: 'Statua' } },
            13: { id: 13, name: "Stanza opaca", description: "L'oscurità qui è quasi tangibile. La luce della tua torcia sembra essere inghiottita a pochi passi da te. Fai fatica a distinguere i contorni della stanza.", image: "13.jpg", connections: { n: null, e: 14, s: 11, w: 1 }, puzzle: { type: 'riddle', question: 'Più passa il tempo, più divento grande. Vivo dove la luce non osa entrare. Un giorno conquistero\' anche l\'universo. Cosa sono?', answer: 'Oscurita\'' } },
            14: { id: 14, name: "Stanza con chiave", description: "Una chiave dorata, ornata di gemme, è incastonata in una fessura nel muro, quasi come se fosse cresciuta dalla roccia stessa.", image: "14.jpg", key: 'k2', connections: { n: 4, e: 10, s: 12, w: 13 } },
            15: { id: 15, name: "Stanza dell'acqua", description: "Scattata una trappola, le porte si sigillano e l'acqua inizia a salire rapidamente da grate sul pavimento. Noti una leva arrugginita appena sotto la superficie, troppo lontana da raggiungere a mani nude.", image: "15.jpg", connections: { n: 5, e: 7, s: 9, w: 16 }, keyRequired: { n: 'k1', e: 'k3', s: 'k2' }, puzzle: { type: 'item', question: 'Le porte si sono chiuse e la stanza si sta riempiendo d\'acqua! Vedi una leva quasi sommersa, che oggetto vuoi usare?', answer: 'Asta_di_ferro' } },
            16: { id: 16, name: "Anticamera del tesoro", description: "Le pareti sono interamente coperte da intricati bassorilievi che raccontano la storia di un antico re. Davanti a te, una porta imponente, ma sigillata. C'è un'iscrizione sopra di essa.", image: "16.jpg", connections: { n: null, e: 15, s: null, w: 17 }, puzzle: { type: 'riddle', question: 'chi è che al mattino cammina con 4 zampe a mezzogiorno con 2 e la sera con 3?', answer: 'Uomo', isSingleTry: true } },
            17: { id: 17, name: "Stanza del tesoro", description: "Montagne d'oro, gioielli scintillanti e antichi manufatti riempiono la stanza fino al soffitto. Ce l'hai fatta!", image: "17.jpg", connections: { n: null, e: null, s: null, w: null } }
        };

        let gameState = {};

        function initializeGame() {
            gameState = {
                currentRoom: 1,
                lives: 3,
                inventory: {
                    items: ["Torcia", "Panno_bagnato", "Scudo", "Asta_di_ferro"],
                    keys: []
                },
                solvedPuzzles: [],
                gameOver: false
            };
            renderInventory();
            render();
        }

        function render() {
            if (gameState.gameOver) return;

            const room = rooms[gameState.currentRoom];

            // Check for game end conditions
            if (gameState.lives <= 0) {
                showGameOver();
                return;
            }
            if (room.id === 17) {
                showVictory();
                return;
            }

            // Update UI elements
            document.getElementById('room-name').textContent = room.name;
            document.getElementById('room-description').textContent = room.description;
            document.getElementById('room-image').src = images_path + room.image;
            document.getElementById('message-area').textContent = '';
            
            updateLivesDisplay();

            // Check for key pickup
            if (room.key && !gameState.inventory.keys.includes(room.key)) {
                collectKey(room.key);
            }

            // Check if there is an active puzzle
            const isPuzzleActive = room.puzzle && !gameState.solvedPuzzles.includes(room.id);
            if (isPuzzleActive) {
                renderPuzzle(room);
            } else {
                renderMovement(room);
            }
        }
        
        function renderMovement(room) {
            const interactionArea = document.getElementById('interaction-area');
            interactionArea.innerHTML = `
                <div class="movement-buttons">
                    <button id="btn-n" class="move-btn">Nord</button>
                    <button id="btn-w" class="move-btn">Ovest</button>
                    <button id="btn-e" class="move-btn">Est</button>
                    <button id="btn-s" class="move-btn">Sud</button>
                </div>
            `;
            
            const directions = { n: 'n', s: 's', e: 'e', w: 'w' };
            for (const dir in directions) {
                const btn = document.getElementById(`btn-${dir}`);
                const targetRoomId = room.connections[dir];
                
                if (targetRoomId) {
                    const requiredKey = room.keyRequired ? room.keyRequired[dir] : null;
                    if (requiredKey && !gameState.inventory.keys.includes(requiredKey)) {
                        btn.disabled = true;
                        btn.title = `Richiede la chiave ${requiredKey.toUpperCase()}`;
                    } else {
                        btn.addEventListener('click', () => move(dir));
                    }
                } else {
                    btn.style.visibility = 'hidden';
                }
            }
        }
        
        function renderPuzzle(room) {
            const interactionArea = document.getElementById('interaction-area');
            interactionArea.innerHTML = `
                <div class="puzzle-interface">
                    <p>${room.puzzle.question}</p>
                    <input type="text" id="puzzle-input" autofocus>
                    <button id="puzzle-submit">Invia</button>
                </div>
            `;
            document.getElementById('puzzle-submit').addEventListener('click', checkAnswer);
            document.getElementById('puzzle-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        }
        
        function move(direction) {
            const currentRoom = rooms[gameState.currentRoom];
            const nextRoomId = currentRoom.connections[direction];
            if (nextRoomId) {
                gameState.currentRoom = nextRoomId;
                render();
            }
        }

        function checkAnswer() {
            const room = rooms[gameState.currentRoom];
            const puzzle = room.puzzle;
            const userInput = document.getElementById('puzzle-input').value;
            
            let isCorrect = false;
            if (puzzle.type === 'riddle') {
                isCorrect = userInput.trim().toLowerCase() === puzzle.answer.toLowerCase();
            } else { // item
                isCorrect = userInput.trim() === puzzle.answer;
            }

            if (isCorrect) {
                gameState.solvedPuzzles.push(room.id);
                document.getElementById('message-area').textContent = 'Corretto! La via è libera.';
                setTimeout(render, 1000);
            } else {
                if (puzzle.isSingleTry) {
                    document.getElementById('message-area').textContent = 'Sbagliato! La trappola scatta inesorabile!';
                    gameState.lives = 0;
                    setTimeout(render, 1500);
                } else {
                    loseLife();
                    if(gameState.lives > 0) {
                        document.getElementById('message-area').textContent = 'Risposta sbagliata... hai perso una vita!';
                        document.getElementById('puzzle-input').value = '';
                        document.getElementById('puzzle-input').focus();
                    }
                }
            }
        }

        function loseLife() {
            if (gameState.lives > 0) {
                gameState.lives--;
                updateLivesDisplay();
                if (gameState.lives <= 0) {
                    render(); // Trigger game over check
                }
            }
        }

        function updateLivesDisplay() {
            document.getElementById('lives').textContent = '♥'.repeat(gameState.lives) + '♡'.repeat(3 - gameState.lives);
        }

        function collectKey(keyId) {
            gameState.inventory.keys.push(keyId);
            document.getElementById('message-area').textContent = 'Hai trovato una chiave!';
            renderInventory();
        }

        function renderInventory() {
            const itemsList = document.getElementById('inventory-items');
            itemsList.innerHTML = '';
            gameState.inventory.items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.replace(/_/g, ' ');
                itemsList.appendChild(li);
            });
            
            const keysList = document.getElementById('inventory-keys');
            keysList.innerHTML = '';
            gameState.inventory.keys.forEach(key => {
                const li = document.createElement('li');
                li.textContent = `Chiave ${key.toUpperCase()}`;
                keysList.appendChild(li);
            });
        }
        
        function showVictory() {
            gameState.gameOver = true;
            document.getElementById('victory-screen').style.display = 'flex';
        }

        function showGameOver() {
            gameState.gameOver = true;
            document.getElementById('game-over-screen').style.display = 'flex';
        }

        // Start the game when the page loads
        window.onload = initializeGame;
    </script>

</body>
</html>
