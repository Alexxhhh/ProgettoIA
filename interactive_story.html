
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avventura nel Tempio</title>
    <style>
        :root {
            --bg-color: #121212;
            --primary-text-color: #E0E0E0;
            --secondary-text-color: #B0B0B0;
            --border-color: #444;
            --accent-color: #bb86fc;
            --disabled-color: #555;
            --life-color: #cf6679;
            --key-color: #fdd835;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #game-container {
            display: flex;
            border: 2px solid var(--border-color);
            width: 1000px;
            max-width: 95%;
            background-color: #1e1e1e;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #sidebar {
            width: 200px;
            padding: 20px;
            border-right: 2px solid var(--border-color);
            background-color: #2a2a2a;
        }

        #sidebar h2 {
            color: var(--accent-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 0;
        }

        #inventory-items ul, #inventory-keys ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        #inventory-items li, #inventory-keys li {
            margin-bottom: 8px;
            color: var(--secondary-text-color);
        }
        
        #inventory-keys li {
            color: var(--key-color);
            font-weight: bold;
        }

        #main-content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #room-name {
            margin: 0;
            color: var(--primary-text-color);
            font-size: 1.8em;
        }

        #lives-display {
            font-size: 1.5em;
            color: var(--life-color);
            letter-spacing: 3px;
        }

        #image-container {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

        #room-image {
            max-width: 100%;
            height: auto;
            border: 2px solid var(--border-color);
            width: 600px;
            height: 400px;
            object-fit: cover;
            background-color: #000;
        }

        #room-description {
            color: var(--secondary-text-color);
            font-size: 1.1em;
            min-height: 60px;
            text-align: center;
        }
        
        #message-area {
            color: var(--accent-color);
            font-weight: bold;
            text-align: center;
            min-height: 24px;
            margin-top: 10px;
        }

        #controls {
            margin-top: auto;
            text-align: center;
        }

        .control-btn {
            background-color: #333;
            border: 1px solid var(--border-color);
            color: var(--primary-text-color);
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s, color 0.2s;
        }

        .control-btn:hover:not(:disabled) {
            background-color: var(--accent-color);
            color: #000;
        }

        .control-btn:disabled {
            background-color: var(--disabled-color);
            color: #888;
            cursor: not-allowed;
            border-color: #444;
        }

        #puzzle-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        #puzzle-question {
            font-style: italic;
            color: var(--secondary-text-color);
        }

        #puzzle-input {
            background-color: #2a2a2a;
            border: 1px solid var(--border-color);
            color: var(--primary-text-color);
            padding: 10px;
            width: 60%;
            font-size: 1em;
        }

        #puzzle-input:focus {
            outline: 1px solid var(--accent-color);
        }

        .end-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 50px;
        }

        .end-screen h1 {
            font-size: 3em;
        }
        
        #victory-screen h1 {
            color: var(--key-color);
        }
        
        #game-over-screen h1 {
            color: var(--life-color);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="sidebar">
            <h2>Inventario</h2>
            <div id="inventory-items"></div>
            <h2>Chiavi</h2>
            <div id="inventory-keys"></div>
        </div>
        <div id="main-content">
            <div id="header">
                <h1 id="room-name"></h1>
                <div id="lives-display"></div>
            </div>

            <div id="image-container">
                <img id="room-image" src="" alt="Immagine della stanza">
            </div>

            <p id="room-description"></p>
            <p id="message-area"></p>

            <div id="controls">
                <div id="movement-controls">
                    <button id="btn-n" class="control-btn" onclick="move('n')">Nord</button>
                    <button id="btn-s" class="control-btn" onclick="move('s')">Sud</button>
                    <button id="btn-e" class="control-btn" onclick="move('e')">Est</button>
                    <button id="btn-w" class="control-btn" onclick="move('w')">Ovest</button>
                </div>
                <div id="puzzle-controls" class="hidden">
                    <p id="puzzle-question"></p>
                    <input type="text" id="puzzle-input" placeholder="Scrivi la risposta...">
                    <button id="btn-submit" class="control-btn" onclick="submitAnswer()">Invia</button>
                </div>
            </div>
        </div>
        
        <div id="victory-screen" class="hidden end-screen">
            <h1>Congratulazioni!</h1>
            <p>Hai trovato il tesoro e sei sopravvissuto al tempio!</p>
            <button class="control-btn" onclick="location.reload()">Ricomincia</button>
        </div>

        <div id="game-over-screen" class="hidden end-screen">
            <h1>Game Over!</h1>
            <p>Sei rimasto senza vite.</p>
            <button class="control-btn" onclick="location.reload()">Ricomincia</button>
        </div>
    </div>

    <script>
        const images_path = 'jpg/';

        const rooms = {
            1: {
                name: "Entrate del tempio",
                description: "Le imponenti porte di pietra si chiudono alle tue spalle. La luce della torcia danza sulle pareti umide, rivelando sentieri che si diramano nell'oscurità.",
                connections: { n: 2, e: 13, s: 12 }
            },
            2: {
                name: "Stanza buia",
                description: "Un fruscio d'ali riempie l'aria. Senti la presenza di innumerevoli creature nell'oscurità impenetrabile.",
                connections: { e: 3, s: 1 },
                puzzle: {
                    question: "La stanza è piena di pipistrelli, che oggetto intendi usare per attraversarla?",
                    correctAnswer: "Torcia"
                }
            },
            3: {
                name: "Stanza con chiave",
                description: "Al centro della stanza, su un piedistallo di pietra, brilla una vecchia chiave di ferro battuto.",
                connections: { e: 4, w: 2 },
                key: 'k4'
            },
            4: {
                name: "Stanza della saggezza",
                description: "Antichi glifi coprono le pareti. Una voce eterea risuona nella tua mente, ponendoti un quesito.",
                connections: { s: 14, w: 3 },
                keyRequirement: { e: 'k1' },
                puzzle: {
                    question: "Mi trovi nel presente, ma non posso essere toccato. Passo silenzioso, nessuno mi vede arrivare. Posso guarire o distruggere. Chi sono?",
                    correctAnswer: "Tempo"
                }
            },
            5: {
                name: "Stanza del gas",
                description: "Appena entri, senti un sibilo e un gas verdastro inizia a riempire la stanza da fessure nel pavimento.",
                connections: { e: 6 },
                keyRequirement: { s: 'k1', w: 'k1' },
                puzzle: {
                    question: "Hai azionato una trappola e la stanza si sta riempiendo di gas! Che oggetto vuoi usare?",
                    correctAnswer: "Panno_bagnato"
                }
            },
            6: {
                name: "Fontana",
                description: "Una fontana di acqua cristallina zampilla al centro della stanza. Il suono dell'acqua è un sollievo in questo luogo silenzioso.",
                connections: { s: 7, w: 5 }
            },
            7: {
                name: "Stanza dei fratelli",
                description: "Quattro bassorilievi raffigurano figure che si inseguono in un ciclo eterno lungo le pareti della stanza.",
                connections: { n: 6, s: 8 },
                keyRequirement: { w: 'k3' },
                puzzle: {
                    question: "Fratelli corrono insieme, nessuno lascia mai il proprio cammino. A volte sono calmi, a volte in guerra, ma sempre si inseguono all'infinito.",
                    correctAnswer: "Stagioni"
                }
            },
            8: {
                name: "Stanza con chiave",
                description: "Una chiave d'argento è incastonata in un teschio che adorna una parete. Sembra guardarti.",
                connections: { n: 7, w: 9 },
                key: 'k3'
            },
            9: {
                name: "Sedia",
                description: "Una singola sedia di legno, stranamente intatta, siede al centro della stanza. Ti senti osservato.",
                connections: { e: 8 },
                keyRequirement: { n: 'k2', w: 'k4' }
            },
            10: {
                name: "Stanza dei buchi",
                description: "Le pareti di questo corridoio sono costellate di piccoli fori scuri. Un meccanismo scatta sotto i tuoi piedi.",
                connections: { n: 14, w: 11 },
                keyRequirement: { e: 'k4' },
                puzzle: {
                    question: "La stanza è piena di buchi sulle pareti. Che oggetto vuoi usare per proseguire?",
                    correctAnswer: "Scudo"
                }
            },
            11: {
                name: "Stanza con chiave",
                description: "In una piccola alcova, una chiave dorata pende da un gancio arrugginito.",
                connections: { e: 10, w: 13 },
                key: 'k1'
            },
            12: {
                name: "Stanza misteriosa",
                description: "Una statua a grandezza naturale di un guerriero incappucciato domina la stanza. I suoi occhi sembrano seguirti.",
                connections: { n: 1, e: 14 },
                puzzle: {
                    question: "Ho occhi ma non posso vedere, una bocca ma non posso parlare, una forma umana ma non lo sono. Chi sono?",
                    correctAnswer: "Statua"
                }
            },
            13: {
                name: "Stanza opaca",
                description: "L'oscurità in questa stanza è così densa da sembrare solida. La tua torcia illumina a malapena i tuoi piedi.",
                connections: { e: 14, s: 11, w: 1 },
                puzzle: {
                    question: "Più passa il tempo, più divento grande. Vivo dove la luce non osa entrare. Un giorno conquisterò anche l'universo. Cosa sono?",
                    correctAnswer: "Oscurità"
                }
            },
            14: {
                name: "Stanza con chiave",
                description: "Una chiave di bronzo giace sul fondo di un bacino prosciugato.",
                connections: { n: 4, e: 10, s: 12, w: 13 },
                key: 'k2'
            },
            15: {
                name: "Stanza dell'acqua",
                description: "Scatti una trappola e l'acqua inizia a salire rapidamente. Le uscite si sigillano con un tonfo.",
                connections: { w: 16 },
                keyRequirement: { n: 'k1', e: 'k3', s: 'k2' },
                puzzle: {
                    question: "Le porte si sono chiuse e la stanza si sta riempiendo d'acqua! Vedi una leva quasi sommersa, che oggetto vuoi usare?",
                    correctAnswer: "Asta_di_ferro"
                }
            },
            16: {
                name: "Anticamera del tesoro",
                description: "Una porta massiccia blocca il passaggio. Un'iscrizione sopra di essa recita: 'Solo i saggi passeranno. Avrai una sola possibilità.'",
                connections: { e: 15, w: 17 },
                puzzle: {
                    question: "Chi è che al mattino cammina con 4 zampe, a mezzogiorno con 2 e la sera con 3?",
                    correctAnswer: "Uomo",
                    singleTry: true
                }
            },
            17: {
                name: "Stanza del tesoro",
                description: "Ce l'hai fatta! Montagne d'oro e gioielli scintillano alla luce della tua torcia.",
                connections: {}
            }
        };
        
        // Add reverse connections based on lore
        rooms[4].connections.e = 5;
        rooms[5].connections.s = 15;
        rooms[5].connections.w = 4;
        rooms[7].connections.w = 15;
        rooms[9].connections.n = 15;
        rooms[9].connections.w = 10;
        rooms[10].connections.e = 9;
        rooms[15].connections.n = 5;
        rooms[15].connections.e = 7;
        rooms[15].connections.s = 9;


        let gameState = {};

        function initGame() {
            gameState = {
                currentRoom: 1,
                lives: 3,
                inventory: {
                    items: ['Torcia', 'Panno_bagnato', 'Scudo', 'Asta_di_ferro'],
                    keys: []
                },
                solvedPuzzles: [],
                gameOver: false
            };
            document.getElementById('puzzle-input').addEventListener('keyup', function(event) {
                if (event.key === "Enter") {
                    submitAnswer();
                }
            });
            render();
        }

        function render() {
            if (gameState.gameOver) return;

            const room = rooms[gameState.currentRoom];

            // Check for victory
            if (gameState.currentRoom === 17) {
                endGame('win');
                return;
            }

            // Update UI elements
            document.getElementById('room-name').textContent = room.name;
            document.getElementById('room-image').src = `${images_path}${gameState.currentRoom}.jpg`;
            document.getElementById('room-description').textContent = room.description;
            
            updateLives();
            updateInventory();
            
            // Clear message area after a short delay
            setTimeout(() => {
                document.getElementById('message-area').textContent = '';
            }, 3000);

            // Check for key pickup
            if (room.key && !gameState.inventory.keys.includes(room.key)) {
                collectKey(room.key);
            }

            // Check for puzzle
            if (room.puzzle && !gameState.solvedPuzzles.includes(gameState.currentRoom)) {
                showPuzzle(room.puzzle);
            } else {
                showMovement(room);
            }
        }

        function updateLives() {
            document.getElementById('lives-display').textContent = '♥'.repeat(gameState.lives);
        }

        function updateInventory() {
            const itemsList = document.getElementById('inventory-items');
            itemsList.innerHTML = '<ul>' + gameState.inventory.items.map(item => `<li>${item.replace(/_/g, ' ')}</li>`).join('') + '</ul>';

            const keysList = document.getElementById('inventory-keys');
            keysList.innerHTML = '<ul>' + gameState.inventory.keys.map(key => `<li>Chiave ${key.substring(1)}</li>`).join('') + '</ul>';
        }

        function move(direction) {
            if (gameState.gameOver) return;

            const room = rooms[gameState.currentRoom];
            const destination = room.connections[direction];

            if (destination) {
                gameState.currentRoom = destination;
                render();
            }
        }

        function showMovement(room) {
            document.getElementById('puzzle-controls').classList.add('hidden');
            document.getElementById('movement-controls').classList.remove('hidden');

            const directions = ['n', 's', 'e', 'w'];
            directions.forEach(dir => {
                const btn = document.getElementById(`btn-${dir}`);
                if (room.connections[dir]) {
                    btn.classList.remove('hidden');
                    const requiredKey = room.keyRequirement ? room.keyRequirement[dir] : null;
                    if (requiredKey && !gameState.inventory.keys.includes(requiredKey)) {
                        btn.disabled = true;
                        btn.title = `Richiede Chiave ${requiredKey.substring(1)}`;
                    } else {
                        btn.disabled = false;
                        btn.title = '';
                    }
                } else {
                    btn.classList.add('hidden');
                }
            });
        }

        function showPuzzle(puzzle) {
            document.getElementById('movement-controls').classList.add('hidden');
            document.getElementById('puzzle-controls').classList.remove('hidden');
            document.getElementById('puzzle-question').textContent = puzzle.question;
            const inputField = document.getElementById('puzzle-input');
            inputField.value = '';
            inputField.focus();
        }

        function submitAnswer() {
            if (gameState.gameOver) return;

            const room = rooms[gameState.currentRoom];
            const puzzle = room.puzzle;
            const userAnswer = document.getElementById('puzzle-input').value.trim();
            
            // Case-insensitive and accent-insensitive comparison
            const normalize = str => str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            if (normalize(userAnswer) === normalize(puzzle.correctAnswer)) {
                document.getElementById('message-area').textContent = "Corretto! Il passaggio è ora sicuro.";
                gameState.solvedPuzzles.push(gameState.currentRoom);
                render();
            } else {
                document.getElementById('message-area').textContent = "Sbagliato! Hai perso una vita.";
                if (puzzle.singleTry) {
                    while(gameState.lives > 0) {
                        loseLife();
                    }
                } else {
                    loseLife();
                }
            }
        }

        function loseLife() {
            if (gameState.lives > 0) {
                gameState.lives--;
                updateLives();
            }
            if (gameState.lives <= 0) {
                endGame('lose');
            }
        }

        function collectKey(keyId) {
            gameState.inventory.keys.push(keyId);
            document.getElementById('message-area').textContent = "Hai trovato una chiave!";
            updateInventory();
        }

        function endGame(status) {
            gameState.gameOver = true;
            document.getElementById('main-content').classList.add('hidden');
            
            if (status === 'win') {
                document.getElementById('victory-screen').classList.remove('hidden');
            } else {
                document.getElementById('game-over-screen').classList.remove('hidden');
            }
        }

        // Start the game when the page loads
        window.onload = initGame;
    </script>

</body>
</html>
