```html
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avventura nel Tempio Labirintico</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --border-color: #444;
            --accent-color: #8b0000;
            --disabled-color: #555;
            --font-family: 'Georgia', serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        #game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }

        #inventory-panel {
            flex: 1;
            min-width: 200px;
            background-color: #252525;
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
        }

        #inventory-panel h2 {
            color: var(--accent-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            margin-top: 0;
            font-size: 1.2em;
        }

        #inventory-panel ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        #inventory-panel li {
            margin-bottom: 8px;
            font-size: 1em;
        }

        #main-panel {
            flex: 3;
            min-width: 600px;
            background-color: #252525;
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #room-name {
            margin: 0;
            color: var(--text-color);
            font-size: 1.8em;
        }

        #lives-display {
            font-size: 1.5em;
            color: var(--accent-color);
            letter-spacing: 2px;
        }

        #content-area {
            text-align: center;
        }

        #room-image {
            max-width: 100%;
            height: auto;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 20px;
            background-color: #000;
        }

        #room-description {
            font-size: 1.1em;
            line-height: 1.6;
            min-height: 50px;
        }

        #message-area {
            color: #ffd700;
            font-style: italic;
            min-height: 24px;
            margin-top: 15px;
        }

        footer {
            margin-top: auto;
            padding-top: 20px;
            text-align: center;
        }

        .controls button {
            background-color: #333;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 12px 24px;
            margin: 5px;
            cursor: pointer;
            font-family: var(--font-family);
            font-size: 1em;
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s;
        }

        .controls button:hover:not(:disabled) {
            background-color: var(--accent-color);
            color: #fff;
        }

        .controls button:disabled {
            background-color: #2a2a2a;
            color: var(--disabled-color);
            cursor: not-allowed;
            border-color: #333;
        }

        #puzzle-controls input[type="text"] {
            background-color: #333;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 12px;
            font-family: var(--font-family);
            font-size: 1em;
            width: 60%;
            border-radius: 4px;
        }

        #end-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #end-message {
            font-size: 3em;
            color: #fff;
            margin-bottom: 30px;
            text-align: center;
        }

        #end-screen button {
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <aside id="inventory-panel">
            <h2>Inventario</h2>
            <ul id="item-list"></ul>
            <h2>Chiavi</h2>
            <ul id="key-list"></ul>
        </aside>
        <div id="main-panel">
            <header>
                <h1 id="room-name"></h1>
                <div id="lives-display"></div>
            </header>
            <main id="content-area">
                <img id="room-image" src="" alt="Immagine della stanza" width="600" height="400">
                <p id="room-description"></p>
                <div id="message-area"></div>
            </main>
            <footer>
                <div id="puzzle-controls" class="controls" style="display: none;">
                    <input type="text" id="puzzle-input" placeholder="Inserisci la risposta...">
                    <button id="puzzle-submit">Invia</button>
                </div>
                <div id="movement-controls" class="controls">
                    <button id="btn-n" onclick="move('n')">Nord</button>
                    <br>
                    <button id="btn-w" onclick="move('w')">Ovest</button>
                    <button id="btn-e" onclick="move('e')">Est</button>
                    <br>
                    <button id="btn-s" onclick="move('s')">Sud</button>
                </div>
            </footer>
        </div>
    </div>

    <div id="end-screen" style="display: none;">
        <div id="end-message"></div>
        <button onclick="restartGame()">Ricomincia</button>
    </div>

    <script>
        const gameData = {
            rooms: {
                1: { name: "Entrate del tempio", description: "Le imponenti porte di pietra sono alle tue spalle. L'aria è fredda e umida. Davanti a te, il tempio attende.", connections: { n: 2, e: 13, s: 12 } },
                2: { name: "Stanza buia", description: "Un fruscio di ali riempie l'aria. Senti la presenza di innumerevoli pipistrelli nell'oscurità.", connections: { e: 3, s: 1 }, puzzle: { type: 'object', question: "La stanza è piena di pipistrelli, che oggetto intendi usare per attraversarla?", answer: "Torcia", solved: false } },
                3: { name: "Stanza con chiave", description: "Su un piedistallo di pietra logoro, noti una chiave di bronzo ossidato.", connections: { e: 4, w: 2 }, keyToCollect: 'k4' },
                4: { name: "Stanza della saggezza", description: "Antichi tomi sono accatastati lungo le pareti, ma sono troppo fragili per essere toccati. Un'aura di conoscenza pervade la stanza.", connections: { e: 5, s: 14, w: 3 }, keyRequired: { e: 'k1' }, puzzle: { type: 'riddle', question: "Mi trovi nel presente, ma non posso essere toccato. Passo silenzioso, nessuno mi vede arrivare. Posso guarire o distruggere. Chi sono?", answer: "Tempo", solved: false } },
                5: { name: "Stanza del gas", description: "Un sibilo inquietante proviene da fessure nelle pareti, e un gas verdastro inizia a riempire l'ambiente.", connections: { e: 6, s: 15, w: 4 }, keyRequired: { s: 'k1', w: 'k1' }, puzzle: { type: 'object', question: "Hai azionato una trappola e la stanza si sta riempiendo di gas! Che oggetto vuoi usare?", answer: "Panno_bagnato", solved: false } },
                6: { name: "Fontana", description: "Una fontana zampilla al centro della stanza. L'acqua sembra pura e fresca, un raro conforto in questo luogo desolato.", connections: { s: 7, w: 5 } },
                7: { name: "Stanza dei fratelli", description: "Quattro grandi bassorilievi sulle pareti raffigurano volti identici ma con espressioni diverse, che sembrano inseguirsi in un ciclo eterno.", connections: { n: 6, s: 8, w: 15 }, keyRequired: { w: 'k3' }, puzzle: { type: 'riddle', question: "Fratelli corrono insieme, nessuno lascia mai il proprio cammino. A volte sono calmi, a volte in guerra, ma sempre si inseguono all'infinito.", answer: "Stagioni", solved: false } },
                8: { name: "Stanza con chiave", description: "Incastonata in una crepa del muro, brilla una chiave d'argento finemente lavorata.", connections: { n: 7, w: 9 }, keyToCollect: 'k3' },
                9: { name: "Sedia", description: "Una singola, austera sedia di pietra siede al centro della stanza, rivolta verso il nulla. Inspira un senso di solitudine e attesa.", connections: { n: 15, e: 8, w: 10 }, keyRequired: { n: 'k2', w: 'k4' } },
                10: { name: "Stanza dei buchi", description: "Le pareti sono costellate di piccoli fori. Senti un leggero click sotto i tuoi piedi, come se un meccanismo si fosse attivato.", connections: { n: 14, e: 9, w: 11 }, keyRequired: { e: 'k4' }, puzzle: { type: 'object', question: "La stanza è piena di buchi sulle pareti. Che oggetto vuoi usare per proseguire?", answer: "Scudo", solved: false } },
                11: { name: "Stanza con chiave", description: "Una chiave dorata pende da una catena arrugginita, appesa al soffitto al centro della stanza.", connections: { e: 10, w: 13 }, keyToCollect: 'k1' },
                12: { name: "Stanza misteriosa", description: "Una grande statua di un guerriero senza volto domina la stanza. I suoi occhi cavi sembrano seguirti.", connections: { n: 1, e: 14 }, puzzle: { type: 'riddle', question: "Ho occhi ma non posso vedere, una bocca ma non posso parlare, una forma umana ma non lo sono. Chi sono?", answer: "Statua", solved: false } },
                13: { name: "Stanza opaca", description: "L'oscurità qui è quasi tangibile, più densa che in qualsiasi altra parte del tempio. La luce della tua torcia sembra essere assorbita dalle pareti.", connections: { e: 14, s: 11, w: 1 }, puzzle: { type: 'riddle', question: "Più passa il tempo, più divento grande. Vivo dove la luce non osa entrare. Un giorno conquistero' anche l'universo. Cosa sono?", answer: "Oscurità", solved: false } },
                14: { name: "Stanza con chiave", description: "Appoggiata su un altare sacrificale, trovi una chiave di ferro nero, fredda al tatto.", connections: { n: 4, e: 10, s: 12, w: 13 }, keyToCollect: 'k2' },
                15: { name: "Stanza dell'acqua", description: "Appena entri, le porte si sigillano e l'acqua inizia a salire rapidamente dal pavimento. Vedi una leva arrugginita quasi sommersa.", connections: { n: 5, e: 7, s: 9, w: 16 }, keyRequired: { n: 'k1', e: 'k3', s: 'k2' }, puzzle: { type: 'object', question: "Le porte si sono chiuse e la stanza si sta riempiendo d'acqua! Vedi una leva quasi sommersa, che oggetto vuoi usare?", answer: "Asta_di_ferro", solved: false } },
                16: { name: "Anticamera del tesoro", description: "Una porta massiccia e decorata blocca il passaggio. Un'iscrizione sopra di essa pone un ultimo enigma. Senti che non ti saranno concessi errori.", connections: { e: 15, w: 17 }, puzzle: { type: 'riddle', question: "Chi è che al mattino cammina con 4 zampe, a mezzogiorno con 2 e la sera con 3?", answer: "Uomo", solved: false, singleTry: true } },
                17: { name: "Stanza del tesoro", description: "Hai raggiunto la meta! Cumuli d'oro, gemme e antichi manufatti riempiono la stanza, brillando alla luce della tua torcia.", connections: {} }
            }
        };

        let player = {
            currentRoom: 1,
            lives: 3,
            inventory: {
                items: ["Torcia", "Panno_bagnato", "Scudo", "Asta_di_ferro"],
                keys: []
            },
            gameOver: false
        };

        const dom = {
            roomName: document.getElementById('room-name'),
            livesDisplay: document.getElementById('lives-display'),
            roomImage: document.getElementById('room-image'),
            roomDescription: document.getElementById('room-description'),
            messageArea: document.getElementById('message-area'),
            itemList: document.getElementById('item-list'),
            keyList: document.getElementById('key-list'),
            movementControls: document.getElementById('movement-controls'),
            puzzleControls: document.getElementById('puzzle-controls'),
            puzzleInput: document.getElementById('puzzle-input'),
            puzzleSubmit: document.getElementById('puzzle-submit'),
            endScreen: document.getElementById('end-screen'),
            endMessage: document.getElementById('end-message'),
            buttons: {
                n: document.getElementById('btn-n'),
                s: document.getElementById('btn-s'),
                e: document.getElementById('btn-e'),
                w: document.getElementById('btn-w')
            }
        };

        function initGame() {
            player.currentRoom = 1;
            player.lives = 3;
            player.inventory.keys = [];
            player.gameOver = false;
            
            // Reset puzzle states
            for (const roomId in gameData.rooms) {
                if (gameData.rooms[roomId].puzzle) {
                    gameData.rooms[roomId].puzzle.solved = false;
                }
                if (gameData.rooms[roomId].keyToCollect) {
                    gameData.rooms[roomId].keyCollected = false;
                }
            }

            renderRoom(player.currentRoom);
            renderInventory();
            renderLives();
        }

        function renderRoom(roomId) {
            if (player.gameOver) return;

            const room = gameData.rooms[roomId];
            dom.roomName.textContent = room.name;
            dom.roomDescription.textContent = room.description;
            dom.roomImage.src = `jpg/${roomId}.jpg`;
            dom.messageArea.textContent = '';

            // Check for win condition
            if (roomId === 17) {
                winGame();
                return;
            }

            // Check for key
            if (room.keyToCollect && !room.keyCollected) {
                collectKey(room.keyToCollect, roomId);
            }

            // Check for puzzle
            if (room.puzzle && !room.puzzle.solved) {
                renderPuzzle(room);
            } else {
                renderMovement(room);
            }
        }

        function renderInventory() {
            dom.itemList.innerHTML = player.inventory.items.map(item => `<li>${item.replace(/_/g, ' ')}</li>`).join('');
            dom.keyList.innerHTML = player.inventory.keys.map(key => `<li>Chiave ${key.toUpperCase()}</li>`).join('');
        }

        function renderLives() {
            dom.livesDisplay.textContent = '♥'.repeat(player.lives);
        }

        function renderMovement(room) {
            dom.puzzleControls.style.display = 'none';
            dom.movementControls.style.display = 'block';

            const directions = ['n', 's', 'e', 'w'];
            directions.forEach(dir => {
                const targetRoomId = room.connections[dir];
                const button = dom.buttons[dir];
                
                if (targetRoomId) {
                    button.disabled = false;
                    const requiredKey = room.keyRequired ? room.keyRequired[dir] : null;
                    if (requiredKey && !player.inventory.keys.includes(requiredKey)) {
                        button.disabled = true;
                    }
                } else {
                    button.disabled = true;
                }
            });
        }

        function renderPuzzle(room) {
            dom.movementControls.style.display = 'none';
            dom.puzzleControls.style.display = 'block';
            dom.roomDescription.textContent = room.puzzle.question;
            dom.puzzleInput.value = '';
            dom.puzzleInput.focus();
        }

        function move(direction) {
            if (player.gameOver) return;
            const currentRoomData = gameData.rooms[player.currentRoom];
            const nextRoomId = currentRoomData.connections[direction];
            if (nextRoomId) {
                player.currentRoom = nextRoomId;
                renderRoom(player.currentRoom);
            }
        }

        function collectKey(keyId, roomId) {
            if (!player.inventory.keys.includes(keyId)) {
                player.inventory.keys.push(keyId);
                gameData.rooms[roomId].keyCollected = true;
                dom.messageArea.textContent = "Hai trovato una chiave!";
                renderInventory();
            }
        }

        function checkPuzzle() {
            if (player.gameOver) return;

            const room = gameData.rooms[player.currentRoom];
            const puzzle = room.puzzle;
            const userAnswer = dom.puzzleInput.value.trim();
            let isCorrect = false;

            if (puzzle.type === 'riddle') {
                isCorrect = userAnswer.toLowerCase() === puzzle.answer.toLowerCase();
            } else { // object
                isCorrect = userAnswer === puzzle.answer;
            }

            if (isCorrect) {
                puzzle.solved = true;
                dom.messageArea.textContent = "Corretto! Il passaggio è ora sicuro.";
                renderRoom(player.currentRoom);
            } else {
                dom.messageArea.textContent = "Sbagliato! Hai subito un danno.";
                if (puzzle.singleTry) {
                    player.lives = 0; // Instant game over for the final riddle
                    gameOver("L'enigma finale ti è stato fatale.");
                } else {
                    loseLife();
                }
            }
        }

        function loseLife() {
            if (player.lives > 0) {
                player.lives--;
                renderLives();
            }
            if (player.lives <= 0) {
                gameOver("Sei rimasto senza vite.");
            }
        }

        function gameOver(message) {
            player.gameOver = true;
            dom.endMessage.textContent = `Game Over! ${message}`;
            dom.endScreen.style.display = 'flex';
        }

        function winGame() {
            player.gameOver = true;
            dom.endMessage.textContent = "Congratulazioni! Hai trovato il tesoro!";
            dom.endScreen.style.display = 'flex';
        }

        function restartGame() {
            window.location.reload();
        }

        dom.puzzleSubmit.addEventListener('click', checkPuzzle);
        dom.puzzleInput.addEventListener('keyup', function(event) {
            if (event.key === "Enter") {
                checkPuzzle();
            }
        });

        document.addEventListener('DOMContentLoaded', initGame);
    </script>

</body>
</html>
```