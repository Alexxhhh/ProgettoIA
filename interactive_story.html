<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Temple of Shadows</title>
<style>
    html,body{margin:0;height:100%;font-family:'Segoe UI',sans-serif;background:#000;color:#fafafa}
    #game{display:grid;grid-template-columns:260px 1fr;height:100vh;overflow:hidden}
    #sidebar{background:#111;padding:12px 14px;box-sizing:border-box}
    h2{margin:10px 0 4px;font-size:18px}
    #inventory{list-style:none;padding:0;margin:0;max-height:45vh;overflow-y:auto}
    #inventory li{margin:2px 0;padding:2px 4px;background:#222;border-radius:4px;font-size:14px}
    #hearts{font-size:24px;letter-spacing:3px;margin-bottom:8px}
    #main{position:relative;overflow:hidden}
    #room-image{width:100%;height:60vh;object-fit:cover;display:block}
    #room-name{font-size:28px;font-weight:600;margin:6px 12px 2px}
    #room-desc{font-size:15px;margin:0 12px 12px;min-height:40px}
    #movement{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin:0 12px}
    #movement button{padding:10px 6px;font-size:15px;background:#272727;border:none;color:#fff;border-radius:6px;cursor:pointer}
    #movement button[disabled]{opacity:.4;cursor:not-allowed}
    #overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;text-align:center;padding:20px;box-sizing:border-box;z-index:999}
    #overlay.show{display:flex}
    #overlay h1{margin:0 0 10px;font-size:42px}
    #overlay p{margin:0;font-size:18px}
    @media (max-width:800px){#game{grid-template-columns:200px 1fr}}
</style>
</head>
<body>
<div id="game">
    <div id="sidebar">
        <h2>Vite</h2>
        <div id="hearts"></div>
        <h2>Chiavi</h2>
        <ul id="inventory"></ul>
    </div>
    <div id="main">
        <img id="room-image" src="" alt="">
        <div id="room-name"></div>
        <div id="room-desc"></div>
        <div id="movement">
            <button id="btn-n">Nord</button>
            <button id="btn-e">Est</button>
            <button id="btn-s">Sud</button>
            <button id="btn-w">Ovest</button>
        </div>
    </div>
</div>
<div id="overlay" onclick="this.classList.remove('show')">
    <div>
        <h1 id="ov-title"></h1>
        <p id="ov-text"></p>
    </div>
</div>

<script>
/* ---------- DATA ---------- */
const rooms={
 'entrance':{n:'TO_Torcia2',e:'TE_Oscurita13',s:'TE_Statua12',name:'Ingresso',img:'https://images.unsplash.com/photo-1589156282025-56d77f66b6e4?auto=format&fit=crop&w=1200&q=80',desc:'L’antico ingresso del tempio.'},
 'TO_Torcia2':{s:'entrance',e:'LK43',name:'Caverna dei Pipistrelli',img:'https://images.unsplash.com/photo-1510192769125-8c1a5e36eebd?auto=format&fit=crop&w=1200&q=80',desc:'Una caverna infestata da pipistrelli.',trapItem:'Torcia'},
 'LK43':{w:'TO_Torcia2',e:'TE_Tempo4',name:'Camera della Chiave 4',img:'https://images.unsplash.com/photo-1520975692151-48155f7eb45a?auto=format&fit=crop&w=1200&q=80',desc:'Una nicchia custodisce una chiave.'},
 'TE_Tempo4':{w:'LK43',s:'LK214',e:'TO_Gas5',name:'Sala del Tempo',img:'https://images.unsplash.com/photo-1533056784812-5b80b624ac94?auto=format&fit=crop&w=1200&q=80',desc:'Un antico meccanismo scandisce il tempo.',puzzle:{q:'Digita la parola magica legata al tempo:',a:'tempo'}},
 'TO_Gas5':{w:'TE_Tempo4',e:'LV6',s:'TO_Asta_di_ferro15',name:'Camera del Gas',img:'https://images.unsplash.com/photo-1502139214984-407e01c42e31?auto=format&fit=crop&w=1200&q=80',desc:'Un gas verde e denso riempie la stanza.',trapItem:'Panno_bagnato'},
 'LV6':{w:'TO_Gas5',s:'TE_Stagioni7',name:'Corridoio di Pietra',img:'https://images.unsplash.com/photo-1500375592092-40eb2168fd21?auto=format&fit=crop&w=1200&q=80',desc:'Un corridoio sicuro di pietra.'},
 'TE_Stagioni7':{n:'LV6',s:'LK38',w:'TO_Asta_di_ferro15',name:'Sala delle Stagioni',img:'https://images.unsplash.com/photo-1499363536502-87642509e31b?auto=format&fit=crop&w=1200&q=80',desc:'I mosaici raffigurano le quattro stagioni.',puzzle:{q:'Digita la parola magica legata alle quattro sorelle:',a:'stagioni'}},
 'LK38':{n:'TE_Stagioni7',w:'LV9',name:'Camera della Chiave 3',img:'https://images.unsplash.com/photo-1526026167906-3b02730988b1?auto=format&fit=crop&w=1200&q=80',desc:'Una chiave luccica su un piedistallo.'},
 'LV9':{e:'LK38',w:'TO_Scudo10',n:'TO_Asta_di_ferro15',name:'Grande Salone',img:'https://images.unsplash.com/photo-1512918602525-9e1a41c668cf?auto=format&fit=crop&w=1200&q=80',desc:'Un ampio salone illuminato da torce.'},
 'TO_Scudo10':{e:'LV9',n:'LK214',w:'LK111',name:'Corridoio delle Frecce',img:'https://images.unsplash.com/photo-1603126853675-be338387ef3e?auto=format&fit=crop&w=1200&q=80',desc:'Scanalature nei muri nascondono frecce mortali.',trapItem:'Scudo'},
 'LK111':{e:'TO_Scudo10',w:'TE_Oscurita13',name:'Camera della Chiave 1',img:'https://images.unsplash.com/photo-1549880338-65ddcdfd017b?auto=format&fit=crop&w=1200&q=80',desc:'Una chiave pende da una statua.'},
 'TE_Statua12':{n:'entrance',e:'LK214',name:'Sala della Statua',img:'https://images.unsplash.com/photo-1511918984145-48de785d4cd0?auto=format&fit=crop&w=1200&q=80',desc:'Una statua colossale ti fissa.',puzzle:{q:'Digita la parola magica per risvegliare la statua:',a:'statua'}},
 'TE_Oscurita13':{e:'LK214',s:'LK111',w:'entrance',name:'Sala dell’Oscurità',img:'https://images.unsplash.com/photo-1517957754642-df3e5c03f7cb?auto=format&fit=crop&w=1200&q=80',desc:'Una tenebra palpabile avvolge tutto.',puzzle:{q:'Digita la parola magica che scaccia l\'oscurità:',a:'ombra'}},
 'LK214':{n:'TE_Tempo4',e:'TO_Scudo10',s:'TE_Statua12',w:'TE_Oscurita13',name:'Camera della Chiave 2',img:'https://images.unsplash.com/photo-1501183638710-841dd1904471?auto=format&fit=crop&w=1200&q=80',desc:'La chiave giace su un altare.'},
 'TO_Asta_di_ferro15':{n:'TO_Gas5',e:'TE_Stagioni7',s:'LV9',w:'treasure_antechamber16',name:'Sala della Leva',img:'https://images.unsplash.com/photo-1495653797063-114787b77b23?auto=format&fit=crop&w=1200&q=80',desc:'Una leva metallica spunta dall’acqua.',trapItem:'Asta_di_ferro'},
 'treasure_antechamber16':{e:'TO_Asta_di_ferro15',w:'treasure_room',name:'Anticamera del Tesoro',img:'https://images.unsplash.com/photo-1605981993102-7fc05459e385?auto=format&fit=crop&w=1200&q=80',desc:'La porta finale è davanti a te.',puzzle:{q:'Digita la parola magica che apre la camera del tesoro:',a:'ricchezza'}},
 'treasure_room':{e:'treasure_antechamber16',name:'Camera del Tesoro',img:'https://images.unsplash.com/photo-1502805941142-2ed2b1bf8912?auto=format&fit=crop&w=1200&q=80',desc:'Montagne di oro scintillano alla luce.'}
};
const lockedDoors={
 'TE_Tempo4|TO_Gas5':'k1','TO_Gas5|TE_Tempo4':'k1','TO_Gas5|TO_Asta_di_ferro15':'k1',
 'TE_Stagioni7|TO_Asta_di_ferro15':'k3','LV9|TO_Asta_di_ferro15':'k2',
 'LV9|TO_Scudo10':'k4','TO_Scudo10|LV9':'k4',
 'TO_Asta_di_ferro15|TO_Gas5':'k1','TO_Asta_di_ferro15|TE_Stagioni7':'k3','TO_Asta_di_ferro15|LV9':'k2'
};
const keyLocations={'LK111':'k1','LK214':'k2','LK38':'k3','LK43':'k4'};
const items=['Torcia','Panno_bagnato','Scudo','Asta_di_ferro'];
let keys=[];
/* ---------- STATE ---------- */
let room='entrance';
let hearts=3;
let active=true;
/* ---------- ELEMENTS ---------- */
const imgEl=$('#room-image'),nameEl=$('#room-name'),descEl=$('#room-desc');
const heartEl=$('#hearts'),invEl=$('#inventory');
const overlay=$('#overlay'),ovT=$('#ov-title'),ovTxt=$('#ov-text');
const dirBtn={n:$('#btn-n'),e:$('#btn-e'),s:$('#btn-s'),w:$('#btn-w')};
/* ---------- HELPERS ---------- */
function $(q){return document.querySelector(q)}
function showOverlay(t,m){ovT.textContent=t;ovTxt.textContent=m;overlay.classList.add('show')}
function updateHearts(){heartEl.innerHTML='♥'.repeat(hearts)+'♡'.repeat(3-hearts)}
function updateInventory(){invEl.innerHTML='';keys.forEach(k=>{const li=document.createElement('li');li.textContent=k;invEl.appendChild(li)})}
function unlockAll(key){for(const d in lockedDoors)if(lockedDoors[d]===key)delete lockedDoors[d]}
function enterRoom(id){
 room=id;
 const r=rooms[room];
 imgEl.src=r.img;nameEl.textContent=r.name;descEl.textContent=r.desc;
 /* key pickup */
 if(keyLocations[room]){const k=keyLocations[room];keys.push(k);delete keyLocations[room];showOverlay('Chiave trovata','Hai raccolto '+k);updateInventory()}
 /* trap */
 if(r.trapItem&&!r.trapCleared){
   if(items.includes(r.trapItem)){r.trapCleared=true;showOverlay('Trappola evitata','Hai usato '+r.trapItem+'.')}
   else{hearts--;updateHearts();showOverlay('Trappola!','Hai perso una vita.');if(hearts===0)return gameOver()}
 }
 /* puzzle */
 if(r.puzzle&&!r.puzzle.solved){
   const ans=prompt(r.puzzle.q);
   if(ans&&ans.trim().toLowerCase()===r.puzzle.a){r.puzzle.solved=true;showOverlay('Puzzle risolto','La via è libera.')}
   else{return gameOver('Hai fallito il puzzle!')}
 }
 /* victory */
 if(room==='treasure_room'){return victory()}
 /* buttons */
 ['n','e','s','w'].forEach(d=>{
   const dest=r[d];if(!dest){dirBtn[d].style.display='none';return}
   dirBtn[d].style.display='block';
   const keyNeeded=lockedDoors[r.name?`${room}`:''];//not used
   const pair=`${room}|${dest}`;
   if(lockedDoors[pair]){
     if(keys.includes(lockedDoors[pair])){dirBtn[d].disabled=false}else{dirBtn[d].disabled=true}
   }else{dirBtn[d].disabled=false}
 })
}
function attemptMove(dir){
 if(!active)return;
 const r=rooms[room],dest=r[dir];if(!dest)return;
 const pair=`${room}|${dest}`;
 if(lockedDoors[pair]){
   const k=lockedDoors[pair];
   if(!keys.includes(k)){showOverlay('Porta chiusa','Serve la chiave '+k);return}
   keys.splice(keys.indexOf(k),1);updateInventory();unlockAll(k);showOverlay('Porta aperta','Hai usato la chiave '+k);
 }
 enterRoom(dest)
}
function gameOver(msg='Hai perso tutte le vite!'){active=false;showOverlay('GAME OVER',msg);Object.values(dirBtn).forEach(b=>b.disabled=true)}
function victory(){active=false;showOverlay('VITTORIA!','Hai trovato il tesoro.');Object.values(dirBtn).forEach(b=>b.disabled=true)}
/* ---------- INIT ---------- */
updateHearts();updateInventory();
Object.entries(dirBtn).forEach(([d,b])=>b.onclick=()=>attemptMove(d));
enterRoom(room);
</script>
</body>
</html>
